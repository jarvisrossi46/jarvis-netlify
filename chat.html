<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jarvis</title>
<style>
body{margin:0;font-family:system-ui;background:#0d1117;color:#c9d1d9;height:100vh;display:flex;flex-direction:column}
.header{background:#161b22;padding:10px 16px;border-bottom:1px solid #30363d;display:flex;justify-content:space-between;align-items:center}
.header h1{margin:0;font-size:16px;color:#58a6ff}
.user{font-size:12px;background:#21262d;padding:4px 10px;border-radius:10px}
.messages{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
.msg{max-width:85%;padding:10px 14px;border-radius:16px;font-size:15px}
.msg.in{background:#21262d;align-self:flex-start;border-bottom-left-radius:4px}
.msg.out{background:#1f6feb;align-self:flex-end;border-bottom-right-radius:4px;color:#fff}
.input{background:#161b22;border-top:1px solid #30363d;padding:10px;display:flex;gap:8px}
.input input{flex:1;background:#0d1117;border:1px solid #30363d;color:#c9d1d9;padding:10px 14px;border-radius:20px;font-size:15px}
.input button{background:#238636;border:none;color:#fff;width:40px;height:40px;border-radius:50%;cursor:pointer}
</style>
</head>
<body>
<div class="header"><h1>Jarvis</h1><span class="user" id="user">...</span><button onclick="logout()">Exit</button></div>
<div class="messages" id="messages"></div>
<div class="input"><input id="msg" placeholder="Message..." onkeypress="if(event.key==='Enter')send()"><button onclick="send()">âž¤</button></div>
<script>
const API='https://jarvis-bridge-arry.netlify.app/.netlify/functions';
const user=sessionStorage.getItem('jarvis_user');
if(!user)location.href='index.html';
document.getElementById('user').textContent=user;
let lastId=0;

async function load(){
  const r=await fetch(`${API}/messages?since=${lastId}`,{headers:{'X-User':user}});
  const msgs=await r.json();
  if(msgs.length){
    const b=document.getElementById('messages');
    msgs.forEach(m=>{
      if(m.id>lastId)lastId=m.id;
      const d=document.createElement('div');
      d.className='msg '+(m.sender===user?'out':'in');
      d.textContent=m.content;
      b.appendChild(d);
    });
    b.scrollTop=b.scrollHeight;
  }
}

async function send(){
  const i=document.getElementById('msg');
  const t=i.value.trim();
  if(!t)return;
  i.value='';
  await fetch(`${API}/messages`,{
    method:'POST',
    headers:{'Content-Type':'application/json','X-User':user},
    body:JSON.stringify({sender:user,content:t})
  });
  load();
}

function logout(){sessionStorage.clear();location.href='index.html';}

load();
setInterval(load,3000);
</script>
</body>
</html>
